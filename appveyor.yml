image: Visual Studio 2015

environment:
  matrix:
  - JOB_NAME: test
    JOB_DESC: "the one that should run every time"

  - JOB_NAME: release
    JOB_DESC: "the one that should run on the release branch"
    START_ON_RELEASE: true

  - JOB_NAME: nightly
    JOB_DESC: "the one that should run on the nightly tag"

  - JOB_NAME: extra1
    JOB_DESC: "the first one that should only run by request"
    IS_EXTRA: true
    START_ON_RELEASE: true

  - JOB_NAME: extra2
    JOB_DESC: "the second one that should only run by request"
    IS_EXTRA: true
    START_ON_RELEASE: true

  - JOB_NAME: extra3
    JOB_DESC: "the third one that should only run by request"
    IS_EXTRA: true
    START_ON_RELEASE: true

  - JOB_NAME: extra4
    JOB_DESC: "the fourth one that should only run by request"
    IS_EXTRA: true
    START_ON_RELEASE: true

for:
-
  branches:
    only:
      - /^release.*/
  matrix:
    only:
      - START_ON_RELEASE: true

-
  branches:
    only:
      - nightly
  matrix:
    only:
      - JOB_NAME: nightly

-
  only_commits:
    message: /\[full ci\]/
  matrix:
    only:
      - IS_EXTRA: true


branches:
  only:
    - master
    - /^release.*/
    - /^feat.*/
    - nightly

init:
- ps: >-
    if ($env:IS_EXTRA -like 'true') {
      # job will start on any release branch build, but it should only run on tags or by request
      if (-not (($env:APPVEYOR_REPO_TAG -like 'true') -or ($env:APPVEYOR_REPO_COMMIT_MESSAGE -like '*`[full ci`]*'))) {
        Write-Host "Not a release candidate and full ci was not requested, bailing.";
        Exit-AppveyorBuild;
      }
    }

build_script:
- ps: Write-Host "Running $env:JOB_NAME job ($env:JOB_DESC).";
