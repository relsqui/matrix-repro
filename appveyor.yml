image: Visual Studio 2015

environment:
  matrix:
  - JOB_NAME: test
    JOB_DESC: "the one that should run every time"

  - JOB_NAME: release
    JOB_DESC: "the one that should run on the release branch"

  - JOB_NAME: nightly
    JOB_DESC: "the one that should run on the nightly tag"

  - JOB_NAME: extra1
    JOB_DESC: "the first one that should only run by request"
    IS_EXTRA: true

  - JOB_NAME: extra2
    JOB_DESC: "the second one that should only run by request"
    IS_EXTRA: true

for:
-
  matrix:
    only:
      - JOB_NAME: release
  branches:
    only:
      - /^release.*/

-
  matrix:
    only:
      - JOB_NAME: nightly
  branches:
    only:
      - nightly

branches:
  only:
    - master
    - /^release.*/
    - /^feat.*/
    - nightly

init:
- ps: >-
    if ($env:IS_EXTRA -like 'true') {
      # run extra jobs when asked in the commit message or on any non-nightly tag
      if (-not ((($env:APPVEYOR_REPO_TAG -like 'true') -and -not ($env:APPVEYOR_REPO_TAG_NAME -like 'nightly')) -or ($env:APPVEYOR_REPO_COMMIT_MESSAGE -like '*`[full ci`]*'))) {
        Write-Host "Not a release candidate and full ci was not requested, bailing.";
        Exit-AppveyorBuild;
      }
    }

build_script:
- ps: Write-Host "Running $env:JOB_NAME job ($env:JOB_DESC).";
